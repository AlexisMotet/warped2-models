# build     <rootPath> <gitBranch> <mpiIncludePath> <mpiLibraryPath> <additionalFlags>

# bagProfile <model> <modelCmd> <maxSimTime> <fileName>

# runBag    <testCycles> <timeoutPeriod> <model> <modelCmd> <maxSimTime>
#           <workerThreads> <staticBagWindowSize> <fracBagWindow> <gvtMethod>
#           <gvtPeriod> <stateSavePeriod> <partitioningFile>

# permuteConfigBag <testCycles> <timeoutPeriod> <model> <modelCmd> <arrMaxSimTime>
#           <arrWorkerThreads> <arrStaticBagWindowSize> <arrFracBagWindow>
#           <arrGvtMethod> <arrGvtPeriod> <arrStateSavePeriod> <partitioningFile>

# runChain  <testCycles> <timeoutPeriod> <model> <modelCmd> <maxSimTime> <workerThreads>
#           <scheduleQCount> <chainSize> <isLpMigrationOn> <gvtMethod> <gvtPeriod>
#           <stateSavePeriod>

# runBlock  <testCycles> <timeoutPeriod> <model> <modelCmd> <maxSimTime>
#           <workerThreads> <scheduleQCount> <blockSize> <isLpMigrationOn>
#           <gvtMethod> <gvtPeriod> <stateSavePeriod>

# permuteConfigGroup <testCycles> <timeoutPeriod> <model> <modelCmd> <arrMaxSimTime>
#           <arrWorkerThreads> <arrScheduleQCount> <groupType> <arrGroupSize>
#           <arrLpMigration> <arrGvtMethod> <arrGvtPeriod> <arrStateSavePeriod>

# runScheduleQ <testCycles> <timeoutPeriod> <model> <modelCmd> <maxSimTime>
#           <workerThreads> <scheduleQType> <scheduleQCount> <isLpMigrationOn>
#           <gvtMethod> <gvtPeriod> <stateSavePeriod>

# permuteConfigScheduleQ <testCycles> <timeoutPeriod> <model> <modelCmd>
#           <arrMaxSimTime> <arrWorkerThreads> <scheduleQType> <arrScheduleQCount>
#           <arrLpMigration> <arrGvtMethod> <arrGvtPeriod> <arrStateSavePeriod>


### Common Configurations ###

root_dir="${PWD}/../.."
mpi_includdir="/usr/include/mpich"
mpi_libdir="/usr/lib/mpich"

model="traffic"
model_cmd="./traffic_sim -x 1024 -y 1024 -n 5"

max_sim_time=("600")

worker_threads_1=("4" "8")
worker_threads_2=("16" "32" "64")

schedule_queues_1=("1"  "2"  "4")
schedule_queues_2=("8" "16")

#lp_migration=("off" "on")
lp_migration=("off")

#gvt_method=("asynchronous" "synchronous")
gvt_method=("asynchronous")

#gvt_period=("128" "512" "1024")
gvt_period=("1000")

state_save_period=("4" "8" "16" "32" "64")

bag_window_size_off=("0")
bag_window_size_on=("4" "8" "16")

frac_bag_window_off=("1.0")
frac_bag_window_on=("0.75" "0.50" "0.25" "0.05")

chain_size=("4" "8" "12" "16")
block_size=("32" "64" "128" "256")


### Execution Sequences ###

# stl-multiset
build $root_dir master $mpi_includdir $mpi_libdir ""
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_1 \
        "stl-multiset" schedule_queues_1 lp_migration gvt_method gvt_period state_save_period
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 \
        "stl-multiset" schedule_queues_1 lp_migration gvt_method gvt_period state_save_period
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 \
        "stl-multiset" schedule_queues_2 lp_migration gvt_method gvt_period state_save_period

# splay-tree
build $root_dir master $mpi_includdir $mpi_libdir "--with-splay-tree"
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_1 \
        "splay-tree" schedule_queues_1 lp_migration gvt_method gvt_period state_save_period
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 \
        "splay-tree" schedule_queues_1 lp_migration gvt_method gvt_period state_save_period
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 \
        "splay-tree" schedule_queues_2 lp_migration gvt_method gvt_period state_save_period

# ladder-queue : 50
build $root_dir master $mpi_includdir $mpi_libdir "--with-sorted-ladder-queue"
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_1 \
        "ladder-queue:50" schedule_queues_1 lp_migration gvt_method gvt_period state_save_period
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 \
        "ladder-queue:50" schedule_queues_1 lp_migration gvt_method gvt_period state_save_period
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 \
        "ladder-queue:50" schedule_queues_2 lp_migration gvt_method gvt_period state_save_period

# unsorted-bottom : 50
build $root_dir master $mpi_includdir $mpi_libdir "--with-partially-sorted-ladder-queue"
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_1 \
        "unsorted-bottom:50" schedule_queues_1 lp_migration gvt_method gvt_period state_save_period
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 \
        "unsorted-bottom:50" schedule_queues_1 lp_migration gvt_method gvt_period state_save_period
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 \
        "unsorted-bottom:50" schedule_queues_2 lp_migration gvt_method gvt_period state_save_period

# lockfree : 50 #
build $root_dir lockfree_ladder_queue $mpi_includdir $mpi_libdir ""
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_1 \
        "lockfree:50" schedule_queues_1 lp_migration gvt_method gvt_period state_save_period
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 \
        "lockfree:50" schedule_queues_1 lp_migration gvt_method gvt_period state_save_period
permuteConfigScheduleQ 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 \
        "lockfree:50" schedule_queues_2 lp_migration gvt_method gvt_period state_save_period

# bags #
#build $root_dir bag_scheduling $mpi_includdir $mpi_libdir ""
#bagProfile "$model" "$model_cmd" 10000 statistics.out
#permuteConfigBag 1 200 "$model" "$model_cmd" max_sim_time worker_threads_1 bag_window_size_on \
#        frac_bag_window_off gvt_method gvt_period state_save_period statistics.out
#permuteConfigBag 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 bag_window_size_on \
#        frac_bag_window_off gvt_method gvt_period state_save_period statistics.out
#permuteConfigBag 1 200 "$model" "$model_cmd" max_sim_time worker_threads_1 bag_window_size_off \
#        frac_bag_window_on gvt_method gvt_period state_save_period statistics.out
#permuteConfigBag 1 200 "$model" "$model_cmd" max_sim_time worker_threads_1 bag_window_size_off \
#        frac_bag_window_on gvt_method gvt_period state_save_period statistics.out

# chains #
#build $root_dir chain_scheduling $mpi_includdir $mpi_libdir ""
#permuteConfigGroup 1 200 "$model" "$model_cmd" max_sim_time worker_threads_1 \
#        schedule_queues_1 "chain" chain_size lp_migration gvt_method gvt_period state_save_period
#permuteConfigGroup 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 \
#        schedule_queues_1 "chain" chain_size lp_migration gvt_method gvt_period state_save_period
#permuteConfigGroup 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 \
#        schedule_queues_2 "chain" chain_size lp_migration gvt_method gvt_period state_save_period

# blocks #
#build $root_dir block_scheduling $mpi_includdir $mpi_libdir ""
#permuteConfigGroup 1 200 "$model" "$model_cmd" max_sim_time worker_threads_1 \
#        schedule_queues_1 "block" block_size lp_migration gvt_method gvt_period state_save_period
#permuteConfigGroup 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 \
#        schedule_queues_1 "block" block_size lp_migration gvt_method gvt_period state_save_period
#permuteConfigGroup 1 200 "$model" "$model_cmd" max_sim_time worker_threads_2 \
#        schedule_queues_2 "block" block_size lp_migration gvt_method gvt_period state_save_period

